<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wunused-imports #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">{- | Construct a graph from constraints
@
   x + n &lt;= y   becomes   x ---(-n)---&gt; y
   x &lt;= n + y   becomes   x ---(+n)---&gt; y
@
the default edge (= no edge) is labelled with infinity.

Building the graph involves keeping track of the node names.
We do this in a finite map, assigning consecutive numbers to nodes.
-}</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.Utils.Warshall</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(!!)</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.SemiRing.html"><span class="hs-identifier">Agda.Utils.SemiRing</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List.html#%21%21"><span class="hs-operator">(!!)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.List.html#nubOn"><span class="hs-identifier">nubOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">type</span><span> </span><span id="Matrix"><span class="annot"><a href="Agda.Utils.Warshall.html#Matrix"><span class="hs-identifier hs-var">Matrix</span></a></span></span><span> </span><span id="local-6989586621681341153"><span class="annot"><a href="#local-6989586621681341153"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681341153"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- assuming a square matrix</span><span>
</span><span id="line-34"></span><span id="local-6989586621681340945"><span class="annot"><a href="Agda.Utils.Warshall.html#warshall"><span class="hs-identifier hs-type">warshall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.SemiRing.html#SemiRing"><span class="hs-identifier hs-type">SemiRing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681340945"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681340945"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681340945"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-35"></span><span id="warshall"><span class="annot"><span class="annottext">warshall :: forall a. SemiRing a =&gt; Matrix a -&gt; Matrix a
</span><a href="Agda.Utils.Warshall.html#warshall"><span class="hs-identifier hs-var hs-var">warshall</span></a></span></span><span> </span><span id="local-6989586621681341167"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341167"><span class="hs-identifier hs-var">a0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Matrix a -&gt; Matrix a
</span><a href="#local-6989586621681341168"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341169"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341167"><span class="hs-identifier hs-var">a0</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>  </span><span id="local-6989586621681341170"><span class="annot"><span class="annottext">b :: ((Int, Int), (Int, Int))
</span><a href="#local-6989586621681341170"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681341169"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341169"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681341171"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341171"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621681341172"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341172"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681341173"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341173"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; ((Int, Int), (Int, Int))
forall i e. Array i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341167"><span class="hs-identifier hs-var">a0</span></a></span><span> </span><span class="hs-comment">-- assuming r == c and r' == c'</span><span>
</span><span id="line-37"></span><span>  </span><span id="local-6989586621681341168"><span class="annot"><span class="annottext">loop :: Int -&gt; Matrix a -&gt; Matrix a
</span><a href="#local-6989586621681341168"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621681341175"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341175"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681341176"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341176"><span class="hs-identifier hs-var">a</span></a></span></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341175"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341172"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Matrix a -&gt; Matrix a
</span><a href="#local-6989586621681341168"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341175"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Matrix a -&gt; Matrix a) -&gt; Matrix a -&gt; Matrix a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int), (Int, Int)) -&gt; [((Int, Int), a)] -&gt; Matrix a
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int), (Int, Int))
</span><a href="#local-6989586621681341170"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">([((Int, Int), a)] -&gt; Matrix a) -&gt; [((Int, Int), a)] -&gt; Matrix a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-40"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341180"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341181"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341176"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341180"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341181"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. SemiRing a =&gt; a -&gt; a -&gt; a
</span><a href="Agda.Utils.SemiRing.html#oplus"><span class="hs-operator hs-var">`oplus`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341176"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341180"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341175"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. SemiRing a =&gt; a -&gt; a -&gt; a
</span><a href="Agda.Utils.SemiRing.html#otimes"><span class="hs-operator hs-var">`otimes`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341176"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341175"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341181"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681341180"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341180"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341169"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341172"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-42"></span><span>          </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341181"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341181"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341171"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341173"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-43"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341176"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">type</span><span> </span><span id="AdjList"><span class="annot"><a href="Agda.Utils.Warshall.html#AdjList"><span class="hs-identifier hs-var">AdjList</span></a></span></span><span> </span><span id="local-6989586621681341185"><span class="annot"><a href="#local-6989586621681341185"><span class="hs-identifier hs-type">node</span></a></span></span><span> </span><span id="local-6989586621681341186"><span class="annot"><a href="#local-6989586621681341186"><span class="hs-identifier hs-type">edge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621681341185"><span class="hs-identifier hs-type">node</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681341185"><span class="hs-identifier hs-type">node</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681341186"><span class="hs-identifier hs-type">edge</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><span class="hs-comment">-- | Warshall's algorithm on a graph represented as an adjacency list.</span></span><span>
</span><span id="line-49"></span><span id="local-6989586621681340962"><span id="local-6989586621681340963"><span class="annot"><a href="Agda.Utils.Warshall.html#warshallG"><span class="hs-identifier hs-type">warshallG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.SemiRing.html#SemiRing"><span class="hs-identifier hs-type">SemiRing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681340962"><span class="hs-identifier hs-type">edge</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621681340963"><span class="hs-identifier hs-type">node</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#AdjList"><span class="hs-identifier hs-type">AdjList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681340963"><span class="hs-identifier hs-type">node</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681340962"><span class="hs-identifier hs-type">edge</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#AdjList"><span class="hs-identifier hs-type">AdjList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681340963"><span class="hs-identifier hs-type">node</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681340962"><span class="hs-identifier hs-type">edge</span></a></span></span></span><span>
</span><span id="line-50"></span><span id="warshallG"><span class="annot"><span class="annottext">warshallG :: forall edge node.
(SemiRing edge, Ord node) =&gt;
AdjList node edge -&gt; AdjList node edge
</span><a href="Agda.Utils.Warshall.html#warshallG"><span class="hs-identifier hs-var hs-var">warshallG</span></a></span></span><span> </span><span id="local-6989586621681341225"><span class="annot"><span class="annottext">AdjList node edge
</span><a href="#local-6989586621681341225"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array (Int, Int) (Maybe edge) -&gt; AdjList node edge
</span><a href="#local-6989586621681341226"><span class="hs-identifier hs-var">fromMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">(Array (Int, Int) (Maybe edge) -&gt; AdjList node edge)
-&gt; Array (Int, Int) (Maybe edge) -&gt; AdjList node edge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array (Int, Int) (Maybe edge) -&gt; Array (Int, Int) (Maybe edge)
forall a. SemiRing a =&gt; Matrix a -&gt; Matrix a
</span><a href="Agda.Utils.Warshall.html#warshall"><span class="hs-identifier hs-var">warshall</span></a></span><span> </span><span class="annot"><span class="annottext">Array (Int, Int) (Maybe edge)
</span><a href="#local-6989586621681341227"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-52"></span><span>    </span><span id="local-6989586621681341228"><span class="annot"><span class="annottext">nodes :: [(node, Int)]
</span><a href="#local-6989586621681341228"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[node] -&gt; [Int] -&gt; [(node, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(node -&gt; node) -&gt; [node] -&gt; [node]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="Agda.Utils.List.html#nubOn"><span class="hs-identifier hs-var">nubOn</span></a></span><span> </span><span class="annot"><span class="annottext">node -&gt; node
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">([node] -&gt; [node]) -&gt; [node] -&gt; [node]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AdjList node edge -&gt; [node]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">AdjList node edge
</span><a href="#local-6989586621681341225"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">[node] -&gt; [node] -&gt; [node]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">((node, edge) -&gt; node) -&gt; [(node, edge)] -&gt; [node]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(node, edge) -&gt; node
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[(node, edge)]] -&gt; [(node, edge)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(node, edge)]] -&gt; [(node, edge)])
-&gt; [[(node, edge)]] -&gt; [(node, edge)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AdjList node edge -&gt; [[(node, edge)]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">AdjList node edge
</span><a href="#local-6989586621681341225"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-54"></span><span>    </span><span id="local-6989586621681341234"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621681341234"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(node, Int)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(node, Int)]
</span><a href="#local-6989586621681341228"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span id="local-6989586621681341236"><span class="annot"><span class="annottext">b :: ((Int, Int), (Int, Int))
</span><a href="#local-6989586621681341236"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341234"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341234"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span>    </span><span id="local-6989586621681341237"><span class="annot"><span class="annottext">edge :: node -&gt; node -&gt; Maybe edge
</span><a href="#local-6989586621681341237"><span class="hs-identifier hs-var hs-var">edge</span></a></span></span><span> </span><span id="local-6989586621681341238"><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341238"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681341239"><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341239"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-58"></span><span>      </span><span id="local-6989586621681341240"><span class="annot"><span class="annottext">[(node, edge)]
</span><a href="#local-6989586621681341240"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">node -&gt; AdjList node edge -&gt; Maybe [(node, edge)]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341238"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">AdjList node edge
</span><a href="#local-6989586621681341225"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><span class="annottext">(Maybe edge -&gt; Maybe edge -&gt; Maybe edge)
-&gt; Maybe edge -&gt; [Maybe edge] -&gt; Maybe edge
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Maybe edge -&gt; Maybe edge -&gt; Maybe edge
forall a. SemiRing a =&gt; a -&gt; a -&gt; a
</span><a href="Agda.Utils.SemiRing.html#oplus"><span class="hs-identifier hs-var">oplus</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe edge
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">edge -&gt; Maybe edge
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">edge
</span><a href="#local-6989586621681341243"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341244"><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341244"><span class="hs-identifier hs-var">j'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341243"><span class="annot"><span class="annottext">edge
</span><a href="#local-6989586621681341243"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(node, edge)]
</span><a href="#local-6989586621681341240"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341239"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">node -&gt; node -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341244"><span class="hs-identifier hs-var">j'</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621681341227"><span class="annot"><span class="annottext">m :: Array (Int, Int) (Maybe edge)
</span><a href="#local-6989586621681341227"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int), (Int, Int))
-&gt; [((Int, Int), Maybe edge)] -&gt; Array (Int, Int) (Maybe edge)
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int), (Int, Int))
</span><a href="#local-6989586621681341236"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341245"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341246"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">node -&gt; node -&gt; Maybe edge
</span><a href="#local-6989586621681341237"><span class="hs-identifier hs-var">edge</span></a></span><span> </span><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341247"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341248"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341247"><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341247"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341245"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341245"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(node, Int)]
</span><a href="#local-6989586621681341228"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341248"><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341248"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341246"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341246"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(node, Int)]
</span><a href="#local-6989586621681341228"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>    </span><span id="local-6989586621681341226"><span class="annot"><span class="annottext">fromMatrix :: Array (Int, Int) (Maybe edge) -&gt; AdjList node edge
</span><a href="#local-6989586621681341226"><span class="hs-identifier hs-var hs-var">fromMatrix</span></a></span></span><span> </span><span id="local-6989586621681341249"><span class="annot"><span class="annottext">Array (Int, Int) (Maybe edge)
</span><a href="#local-6989586621681341249"><span class="hs-identifier hs-var">matrix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(node, edge)] -&gt; [(node, edge)] -&gt; [(node, edge)])
-&gt; [(node, [(node, edge)])] -&gt; AdjList node edge
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">[(node, edge)] -&gt; [(node, edge)] -&gt; [(node, edge)]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">([(node, [(node, edge)])] -&gt; AdjList node edge)
-&gt; [(node, [(node, edge)])] -&gt; AdjList node edge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-64"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681341252"><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341252"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341253"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341253"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(node, Int)]
</span><a href="#local-6989586621681341228"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-65"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681341254"><span class="annot"><span class="annottext">es :: [(node, edge)]
</span><a href="#local-6989586621681341254"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(node, Int) -&gt; node
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(node, Int)]
</span><a href="#local-6989586621681341228"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">[(node, Int)] -&gt; Int -&gt; (node, Int)
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="Agda.Utils.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341255"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">edge
</span><a href="#local-6989586621681341256"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681341255"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341255"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341234"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-67"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681341256"><span class="annot"><span class="annottext">edge
</span><a href="#local-6989586621681341256"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Array (Int, Int) (Maybe edge)
</span><a href="#local-6989586621681341249"><span class="hs-identifier hs-var">matrix</span></a></span><span> </span><span class="annot"><span class="annottext">Array (Int, Int) (Maybe edge) -&gt; (Int, Int) -&gt; Maybe edge
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341253"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341255"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-68"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-69"></span><span>      </span><span class="annot"><span class="annottext">(node, [(node, edge)]) -&gt; [(node, [(node, edge)])]
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">node
</span><a href="#local-6989586621681341252"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(node, edge)]
</span><a href="#local-6989586621681341254"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><span class="hs-comment">-- | Edge weight in the graph, forming a semi ring.</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">data</span><span> </span><span id="Weight"><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-var">Weight</span></a></span></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Finite"><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-var">Finite</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Infinite"><span class="annot"><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341260"><span id="local-6989586621681341263"><span class="annot"><span class="annottext">Weight -&gt; Weight -&gt; Bool
(Weight -&gt; Weight -&gt; Bool)
-&gt; (Weight -&gt; Weight -&gt; Bool) -&gt; Eq Weight
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Weight -&gt; Weight -&gt; Bool
== :: Weight -&gt; Weight -&gt; Bool
$c/= :: Weight -&gt; Weight -&gt; Bool
/= :: Weight -&gt; Weight -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341268"><span id="local-6989586621681341273"><span id="local-6989586621681341277"><span class="annot"><span class="annottext">Int -&gt; Weight -&gt; ShowS
[Weight] -&gt; ShowS
Weight -&gt; String
(Int -&gt; Weight -&gt; ShowS)
-&gt; (Weight -&gt; String) -&gt; ([Weight] -&gt; ShowS) -&gt; Show Weight
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Weight -&gt; ShowS
showsPrec :: Int -&gt; Weight -&gt; ShowS
$cshow :: Weight -&gt; String
show :: Weight -&gt; String
$cshowList :: [Weight] -&gt; ShowS
showList :: [Weight] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><a href="Agda.Utils.Warshall.html#inc"><span class="hs-identifier hs-type">inc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span>
</span><span id="line-78"></span><span id="inc"><span class="annot"><span class="annottext">inc :: Weight -&gt; Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#inc"><span class="hs-identifier hs-var hs-var">inc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span>   </span><span id="local-6989586621681341281"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341281"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span>
</span><span id="line-79"></span><span class="annot"><a href="Agda.Utils.Warshall.html#inc"><span class="hs-identifier hs-var">inc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341282"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341282"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681341283"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341283"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-var">Finite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341282"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341283"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681341286"><span id="local-6989586621681341290"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-82"></span><span>  </span><span id="local-6989586621681341297"><span class="annot"><span class="annottext">pretty :: Weight -&gt; Doc
</span><a href="#local-6989586621681341297"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341299"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341299"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341299"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681341303"><span id="local-6989586621681341306"><span id="local-6989586621681341310"><span id="local-6989586621681341313"><span id="local-6989586621681341316"><span id="local-6989586621681341319"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>  </span><span id="local-6989586621681341323"><span class="annot"><span class="annottext">Weight
</span><a href="#local-6989586621681341323"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681341324"><span class="annot"><span class="annottext">&lt;= :: Weight -&gt; Weight -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;=</span></span></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span id="local-6989586621681341325"><span class="annot"><span class="annottext">Weight
</span><a href="#local-6989586621681341325"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341326"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341326"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341327"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341327"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341326"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341327"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.Utils.SemiRing.html#SemiRing"><span class="hs-identifier hs-type">SemiRing</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621681341333"><span class="annot"><span class="annottext">ozero :: Weight
</span><a href="#local-6989586621681341333"><span class="hs-identifier hs-var hs-var hs-var hs-var">ozero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span id="local-6989586621681341335"><span class="annot"><span class="annottext">oone :: Weight
</span><a href="#local-6989586621681341335"><span class="hs-identifier hs-var hs-var hs-var hs-var">oone</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-var">Finite</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621681341338"><span class="annot"><span class="annottext">oplus :: Weight -&gt; Weight -&gt; Weight
</span><a href="Agda.Utils.SemiRing.html#oplus"><span class="hs-identifier hs-var hs-var hs-var hs-var">oplus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Weight -&gt; Weight -&gt; Weight
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>  </span><span id="local-6989586621681341341"><span class="annot"><span class="annottext">otimes :: Weight -&gt; Weight -&gt; Weight
</span><a href="Agda.Utils.SemiRing.html#otimes"><span class="hs-identifier hs-var hs-var hs-var hs-var">otimes</span></a></span></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Agda.Utils.SemiRing.html#otimes"><span class="hs-identifier hs-var">otimes</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Agda.Utils.SemiRing.html#otimes"><span class="hs-identifier hs-var">otimes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341342"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341342"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341343"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341343"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-var">Finite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341342"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341343"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- constraints ---------------------------------------------------</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | Nodes of the graph are either</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- - flexible variables (with identifiers drawn from @Int@),</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- - rigid variables (also identified by @Int@s), or</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- - constants (like 0, infinity, or anything between).</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-keyword">data</span><span> </span><span id="Node"><span class="annot"><a href="Agda.Utils.Warshall.html#Node"><span class="hs-identifier hs-var">Node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Rigid"><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span>
</span><span id="line-108"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="Flex"><span class="annot"><a href="Agda.Utils.Warshall.html#Flex"><span class="hs-identifier hs-var">Flex</span></a></span></span><span>  </span><span class="annot"><a href="Agda.Utils.Warshall.html#FlexId"><span class="hs-identifier hs-type">FlexId</span></a></span><span>
</span><span id="line-109"></span><span>            </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341348"><span id="local-6989586621681341353"><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Bool
(Node -&gt; Node -&gt; Bool) -&gt; (Node -&gt; Node -&gt; Bool) -&gt; Eq Node
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Node -&gt; Node -&gt; Bool
== :: Node -&gt; Node -&gt; Bool
$c/= :: Node -&gt; Node -&gt; Bool
/= :: Node -&gt; Node -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341359"><span id="local-6989586621681341364"><span id="local-6989586621681341368"><span id="local-6989586621681341371"><span id="local-6989586621681341374"><span id="local-6989586621681341377"><span id="local-6989586621681341380"><span class="annot"><span class="annottext">Eq Node
Eq Node =&gt;
(Node -&gt; Node -&gt; Ordering)
-&gt; (Node -&gt; Node -&gt; Bool)
-&gt; (Node -&gt; Node -&gt; Bool)
-&gt; (Node -&gt; Node -&gt; Bool)
-&gt; (Node -&gt; Node -&gt; Bool)
-&gt; (Node -&gt; Node -&gt; Node)
-&gt; (Node -&gt; Node -&gt; Node)
-&gt; Ord Node
Node -&gt; Node -&gt; Bool
Node -&gt; Node -&gt; Ordering
Node -&gt; Node -&gt; Node
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Node -&gt; Node -&gt; Ordering
compare :: Node -&gt; Node -&gt; Ordering
$c&lt; :: Node -&gt; Node -&gt; Bool
&lt; :: Node -&gt; Node -&gt; Bool
$c&lt;= :: Node -&gt; Node -&gt; Bool
&lt;= :: Node -&gt; Node -&gt; Bool
$c&gt; :: Node -&gt; Node -&gt; Bool
&gt; :: Node -&gt; Node -&gt; Bool
$c&gt;= :: Node -&gt; Node -&gt; Bool
&gt;= :: Node -&gt; Node -&gt; Bool
$cmax :: Node -&gt; Node -&gt; Node
max :: Node -&gt; Node -&gt; Node
$cmin :: Node -&gt; Node -&gt; Node
min :: Node -&gt; Node -&gt; Node
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">data</span><span> </span><span id="Rigid"><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RConst"><span class="annot"><a href="Agda.Utils.Warshall.html#RConst"><span class="hs-identifier hs-var">RConst</span></a></span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span>
</span><span id="line-112"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="RVar"><span class="annot"><a href="Agda.Utils.Warshall.html#RVar"><span class="hs-identifier hs-var">RVar</span></a></span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#RigidId"><span class="hs-identifier hs-type">RigidId</span></a></span><span>
</span><span id="line-113"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341386"><span id="local-6989586621681341390"><span class="annot"><span class="annottext">Rigid -&gt; Rigid -&gt; Bool
(Rigid -&gt; Rigid -&gt; Bool) -&gt; (Rigid -&gt; Rigid -&gt; Bool) -&gt; Eq Rigid
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Rigid -&gt; Rigid -&gt; Bool
== :: Rigid -&gt; Rigid -&gt; Bool
$c/= :: Rigid -&gt; Rigid -&gt; Bool
/= :: Rigid -&gt; Rigid -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341395"><span id="local-6989586621681341399"><span id="local-6989586621681341403"><span id="local-6989586621681341406"><span id="local-6989586621681341409"><span id="local-6989586621681341412"><span id="local-6989586621681341415"><span class="annot"><span class="annottext">Eq Rigid
Eq Rigid =&gt;
(Rigid -&gt; Rigid -&gt; Ordering)
-&gt; (Rigid -&gt; Rigid -&gt; Bool)
-&gt; (Rigid -&gt; Rigid -&gt; Bool)
-&gt; (Rigid -&gt; Rigid -&gt; Bool)
-&gt; (Rigid -&gt; Rigid -&gt; Bool)
-&gt; (Rigid -&gt; Rigid -&gt; Rigid)
-&gt; (Rigid -&gt; Rigid -&gt; Rigid)
-&gt; Ord Rigid
Rigid -&gt; Rigid -&gt; Bool
Rigid -&gt; Rigid -&gt; Ordering
Rigid -&gt; Rigid -&gt; Rigid
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Rigid -&gt; Rigid -&gt; Ordering
compare :: Rigid -&gt; Rigid -&gt; Ordering
$c&lt; :: Rigid -&gt; Rigid -&gt; Bool
&lt; :: Rigid -&gt; Rigid -&gt; Bool
$c&lt;= :: Rigid -&gt; Rigid -&gt; Bool
&lt;= :: Rigid -&gt; Rigid -&gt; Bool
$c&gt; :: Rigid -&gt; Rigid -&gt; Bool
&gt; :: Rigid -&gt; Rigid -&gt; Bool
$c&gt;= :: Rigid -&gt; Rigid -&gt; Bool
&gt;= :: Rigid -&gt; Rigid -&gt; Bool
$cmax :: Rigid -&gt; Rigid -&gt; Rigid
max :: Rigid -&gt; Rigid -&gt; Rigid
$cmin :: Rigid -&gt; Rigid -&gt; Rigid
min :: Rigid -&gt; Rigid -&gt; Rigid
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">type</span><span> </span><span id="NodeId"><span class="annot"><a href="Agda.Utils.Warshall.html#NodeId"><span class="hs-identifier hs-var">NodeId</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">type</span><span> </span><span id="RigidId"><span class="annot"><a href="Agda.Utils.Warshall.html#RigidId"><span class="hs-identifier hs-var">RigidId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">type</span><span> </span><span id="FlexId"><span class="annot"><a href="Agda.Utils.Warshall.html#FlexId"><span class="hs-identifier hs-var">FlexId</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">type</span><span> </span><span id="Scope"><span class="annot"><a href="Agda.Utils.Warshall.html#Scope"><span class="hs-identifier hs-var">Scope</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#RigidId"><span class="hs-identifier hs-type">RigidId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-119"></span><span class="annot"><span class="hs-comment">-- ^ Which rigid variables a flex may be instatiated to.</span></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681341421"><span id="local-6989586621681341425"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Node"><span class="hs-identifier hs-type">Node</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621681341436"><span class="annot"><span class="annottext">pretty :: Node -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Flex"><span class="hs-identifier hs-type">Flex</span></a></span><span>  </span><span id="local-6989586621681341437"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341437"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;?&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341437"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RVar"><span class="hs-identifier hs-type">RVar</span></a></span><span> </span><span id="local-6989586621681341438"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341438"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;v&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341438"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RConst"><span class="hs-identifier hs-type">RConst</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;#&quot;</span></span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RConst"><span class="hs-identifier hs-type">RConst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341439"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341439"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341439"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="annot"><a href="Agda.Utils.Warshall.html#infinite"><span class="hs-identifier hs-type">infinite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-128"></span><span id="infinite"><span class="annot"><span class="annottext">infinite :: Rigid -&gt; Bool
</span><a href="Agda.Utils.Warshall.html#infinite"><span class="hs-identifier hs-var hs-var">infinite</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RConst"><span class="hs-identifier hs-type">RConst</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-129"></span><span class="annot"><a href="Agda.Utils.Warshall.html#infinite"><span class="hs-identifier hs-var">infinite</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">-- | @isBelow r w r'@</span><span>
</span><span id="line-132"></span><span class="hs-comment">--   checks, if @r@ and @r'@ are connected by @w@ (meaning @w@ not infinite),</span><span>
</span><span id="line-133"></span><span class="hs-comment">--   whether @r + w &lt;= r'@.</span><span>
</span><span id="line-134"></span><span class="hs-comment">--   Precondition: not the same rigid variable.</span><span>
</span><span id="line-135"></span><span class="annot"><a href="Agda.Utils.Warshall.html#isBelow"><span class="hs-identifier hs-type">isBelow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-136"></span><span id="isBelow"><span class="annot"><span class="annottext">isBelow :: Rigid -&gt; Weight -&gt; Rigid -&gt; Bool
</span><a href="Agda.Utils.Warshall.html#isBelow"><span class="hs-identifier hs-var hs-var">isBelow</span></a></span></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Agda.Utils.Warshall.html#isBelow"><span class="hs-identifier hs-var">isBelow</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681341442"><span class="annot"><span class="annottext">Weight
</span><a href="#local-6989586621681341442"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RConst"><span class="hs-identifier hs-type">RConst</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-138"></span><span class="annot"><a href="Agda.Utils.Warshall.html#isBelow"><span class="hs-identifier hs-var">isBelow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RConst"><span class="hs-identifier hs-type">RConst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341443"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341443"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341444"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341444"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RConst"><span class="hs-identifier hs-type">RConst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341445"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341445"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341443"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341444"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341445"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-139"></span><span class="annot"><a href="Agda.Utils.Warshall.html#isBelow"><span class="hs-identifier hs-var">isBelow</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Weight
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- rigid variables are not related</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><span class="hs-comment">-- | A constraint is an edge in the graph.</span></span><span>
</span><span id="line-142"></span><span class="hs-keyword">data</span><span> </span><span id="Constraint"><span class="annot"><a href="Agda.Utils.Warshall.html#Constraint"><span class="hs-identifier hs-var">Constraint</span></a></span></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NewFlex"><span class="annot"><a href="Agda.Utils.Warshall.html#NewFlex"><span class="hs-identifier hs-var">NewFlex</span></a></span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#FlexId"><span class="hs-identifier hs-type">FlexId</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Arc"><span class="annot"><a href="Agda.Utils.Warshall.html#Arc"><span class="hs-identifier hs-var">Arc</span></a></span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- ^ For @Arc v1 k v2@  at least one of @v1@ or @v2@ is a @MetaV@ (Flex),</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">--                      the other a @MetaV@ or a @Var@ (Rigid).</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">--   If @k &lt;= 0@ this means  @suc^(-k) v1 &lt;= v2@</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">--   otherwise               @v1 &lt;= suc^k v3@.</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681341450"><span id="local-6989586621681341454"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621681341481"><span class="annot"><span class="annottext">pretty :: Constraint -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#NewFlex"><span class="hs-identifier hs-type">NewFlex</span></a></span><span> </span><span id="local-6989586621681341482"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341482"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681341483"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621681341483"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;SizeMeta(?&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341482"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;)&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Arc"><span class="hs-identifier hs-type">Arc</span></a></span><span> </span><span id="local-6989586621681341485"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341485"><span class="hs-identifier hs-var">v1</span></a></span></span><span> </span><span id="local-6989586621681341486"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341486"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681341487"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341487"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341486"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341485"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;&lt;=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341487"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341486"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341485"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;+&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341486"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;&lt;=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341487"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
forall (t :: * -&gt; *). Foldable t =&gt; t Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341485"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;&lt;=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341487"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;+&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341486"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-keyword">type</span><span> </span><span id="Constraints"><span class="annot"><a href="Agda.Utils.Warshall.html#Constraints"><span class="hs-identifier hs-var">Constraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.Warshall.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><a href="Agda.Utils.Warshall.html#emptyConstraints"><span class="hs-identifier hs-type">emptyConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Constraints"><span class="hs-identifier hs-type">Constraints</span></a></span><span>
</span><span id="line-160"></span><span id="emptyConstraints"><span class="annot"><span class="annottext">emptyConstraints :: [Constraint]
</span><a href="Agda.Utils.Warshall.html#emptyConstraints"><span class="hs-identifier hs-var hs-var">emptyConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">-- graph (matrix) ------------------------------------------------</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-keyword">data</span><span> </span><span id="Graph"><span class="annot"><a href="Agda.Utils.Warshall.html#Graph"><span class="hs-identifier hs-var">Graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Graph"><span class="annot"><a href="Agda.Utils.Warshall.html#Graph"><span class="hs-identifier hs-var">Graph</span></a></span></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="flexScope"><span class="annot"><span class="annottext">Graph -&gt; Map Int (Int -&gt; Bool)
</span><a href="Agda.Utils.Warshall.html#flexScope"><span class="hs-identifier hs-var hs-var">flexScope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#FlexId"><span class="hs-identifier hs-type">FlexId</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Scope for each flexible var.</span></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="nodeMap"><span class="annot"><span class="annottext">Graph -&gt; Map Node Int
</span><a href="Agda.Utils.Warshall.html#nodeMap"><span class="hs-identifier hs-var hs-var">nodeMap</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Node labels to node numbers.</span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="intMap"><span class="annot"><span class="annottext">Graph -&gt; Map Int Node
</span><a href="Agda.Utils.Warshall.html#intMap"><span class="hs-identifier hs-var hs-var">intMap</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Node numbers to node labels.</span></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="nextNode"><span class="annot"><span class="annottext">Graph -&gt; Int
</span><a href="Agda.Utils.Warshall.html#nextNode"><span class="hs-identifier hs-var hs-var">nextNode</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span>                     </span><span class="annot"><span class="hs-comment">-- ^ Number of nodes @n@.</span></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="graph"><span class="annot"><span class="annottext">Graph -&gt; Int -&gt; Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#graph"><span class="hs-identifier hs-var hs-var">graph</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#NodeId"><span class="hs-identifier hs-type">NodeId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The edges (restrict to @[0..n[@).</span></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><span class="hs-comment">-- | The empty graph: no nodes, edges are all undefined (infinity weight).</span></span><span>
</span><span id="line-173"></span><span class="annot"><a href="Agda.Utils.Warshall.html#initGraph"><span class="hs-identifier hs-type">initGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span>
</span><span id="line-174"></span><span id="initGraph"><span class="annot"><span class="annottext">initGraph :: Graph
</span><a href="Agda.Utils.Warshall.html#initGraph"><span class="hs-identifier hs-var hs-var">initGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Int (Int -&gt; Bool)
-&gt; Map Node Int
-&gt; Map Int Node
-&gt; Int
-&gt; (Int -&gt; Int -&gt; Weight)
-&gt; Graph
</span><a href="Agda.Utils.Warshall.html#Graph"><span class="hs-identifier hs-var">Graph</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int (Int -&gt; Bool)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Map Node Int
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Map Int Node
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681341499"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341499"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681341500"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341500"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><span class="hs-comment">-- | The Graph Monad, for constructing a graph iteratively.</span></span><span>
</span><span id="line-177"></span><span class="hs-keyword">type</span><span> </span><span id="GM"><span class="annot"><a href="Agda.Utils.Warshall.html#GM"><span class="hs-identifier hs-var">GM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="annot"><span class="hs-comment">-- | Add a size meta node.</span></span><span>
</span><span id="line-180"></span><span class="annot"><a href="Agda.Utils.Warshall.html#addFlex"><span class="hs-identifier hs-type">addFlex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#FlexId"><span class="hs-identifier hs-type">FlexId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#GM"><span class="hs-identifier hs-type">GM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span id="addFlex"><span class="annot"><span class="annottext">addFlex :: Int -&gt; (Int -&gt; Bool) -&gt; GM ()
</span><a href="Agda.Utils.Warshall.html#addFlex"><span class="hs-identifier hs-var hs-var">addFlex</span></a></span></span><span> </span><span id="local-6989586621681341502"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341502"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681341503"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621681341503"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="annottext">(Graph -&gt; Graph) -&gt; GM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((Graph -&gt; Graph) -&gt; GM ()) -&gt; (Graph -&gt; Graph) -&gt; GM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681341505"><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341505"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341505"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#flexScope"><span class="hs-identifier hs-var">flexScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621681341502"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341503"><span class="hs-identifier hs-type">scope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#flexScope"><span class="hs-identifier hs-var">flexScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341505"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Node -&gt; GM Int
</span><a href="Agda.Utils.Warshall.html#addNode"><span class="hs-identifier hs-var">addNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Node
</span><a href="Agda.Utils.Warshall.html#Flex"><span class="hs-identifier hs-var">Flex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341502"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><span class="annottext">() -&gt; GM ()
forall a. a -&gt; StateT Graph Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- | Lookup identifier of a node.</span><span>
</span><span id="line-187"></span><span class="hs-comment">--   If not present, it is added first.</span><span>
</span><span id="line-188"></span><span class="annot"><a href="Agda.Utils.Warshall.html#addNode"><span class="hs-identifier hs-type">addNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#GM"><span class="hs-identifier hs-type">GM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-189"></span><span id="addNode"><span class="annot"><span class="annottext">addNode :: Node -&gt; GM Int
</span><a href="Agda.Utils.Warshall.html#addNode"><span class="hs-identifier hs-var hs-var">addNode</span></a></span></span><span> </span><span id="local-6989586621681341508"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341508"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621681341509"><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341509"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Graph Identity Graph
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Map Node Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341508"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Map Node Int
</span><a href="Agda.Utils.Warshall.html#nodeMap"><span class="hs-identifier hs-var">nodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341509"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681341511"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341511"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; GM Int
forall a. a -&gt; StateT Graph Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341511"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681341512"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621681341512"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Graph -&gt; Int
</span><a href="Agda.Utils.Warshall.html#nextNode"><span class="hs-identifier hs-var">nextNode</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341509"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><span class="annottext">Graph -&gt; GM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(Graph -&gt; GM ()) -&gt; Graph -&gt; GM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341509"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#nodeMap"><span class="hs-identifier hs-var">nodeMap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621681341508"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341512"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#nodeMap"><span class="hs-identifier hs-var">nodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341509"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#intMap"><span class="hs-identifier hs-var">intMap</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621681341512"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341508"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#intMap"><span class="hs-identifier hs-var">intMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341509"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#nextNode"><span class="hs-identifier hs-var">nextNode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681341512"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-198"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-199"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; GM Int
forall a. a -&gt; StateT Graph Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341512"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">-- | @addEdge n1 k n2@</span><span>
</span><span id="line-202"></span><span class="hs-comment">--   improves the weight of egde @n1-&gt;n2@ to be at most @k@.</span><span>
</span><span id="line-203"></span><span class="hs-comment">--   Also adds nodes if not yet present.</span><span>
</span><span id="line-204"></span><span class="annot"><a href="Agda.Utils.Warshall.html#addEdge"><span class="hs-identifier hs-type">addEdge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#GM"><span class="hs-identifier hs-type">GM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span id="addEdge"><span class="annot"><span class="annottext">addEdge :: Node -&gt; Int -&gt; Node -&gt; GM ()
</span><a href="Agda.Utils.Warshall.html#addEdge"><span class="hs-identifier hs-var hs-var">addEdge</span></a></span></span><span> </span><span id="local-6989586621681341515"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341515"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621681341516"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341516"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681341517"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341517"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621681341518"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341518"><span class="hs-identifier hs-var">i1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Node -&gt; GM Int
</span><a href="Agda.Utils.Warshall.html#addNode"><span class="hs-identifier hs-var">addNode</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341515"><span class="hs-identifier hs-var">n1</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621681341519"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341519"><span class="hs-identifier hs-var">i2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Node -&gt; GM Int
</span><a href="Agda.Utils.Warshall.html#addNode"><span class="hs-identifier hs-var">addNode</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341517"><span class="hs-identifier hs-var">n2</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span id="local-6989586621681341520"><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341520"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Graph Identity Graph
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681341521"><span class="annot"><span class="annottext">graph' :: Int -&gt; Int -&gt; Weight
</span><a href="#local-6989586621681341521"><span class="hs-identifier hs-var hs-var">graph'</span></a></span></span><span> </span><span id="local-6989586621681341522"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341522"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681341523"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341523"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341522"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341523"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; (Int, Int) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341518"><span class="hs-identifier hs-var">i1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341519"><span class="hs-identifier hs-var">i2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-var">Finite</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341516"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Weight -&gt; Weight -&gt; Weight
forall a. SemiRing a =&gt; a -&gt; a -&gt; a
</span><a href="Agda.Utils.SemiRing.html#oplus"><span class="hs-operator hs-var">`oplus`</span></a></span><span> </span><span class="annot"><span class="annottext">Graph -&gt; Int -&gt; Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#graph"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341520"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341522"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341523"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-210"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Graph -&gt; Int -&gt; Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#graph"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341520"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341522"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341523"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><span class="annottext">Graph -&gt; GM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(Graph -&gt; GM ()) -&gt; Graph -&gt; GM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341520"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#graph"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681341521"><span class="hs-identifier hs-type">graph'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="annot"><a href="Agda.Utils.Warshall.html#addConstraint"><span class="hs-identifier hs-type">addConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#GM"><span class="hs-identifier hs-type">GM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span id="addConstraint"><span class="annot"><span class="annottext">addConstraint :: Constraint -&gt; GM ()
</span><a href="Agda.Utils.Warshall.html#addConstraint"><span class="hs-identifier hs-var hs-var">addConstraint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#NewFlex"><span class="hs-identifier hs-type">NewFlex</span></a></span><span> </span><span id="local-6989586621681341525"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341525"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681341526"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621681341526"><span class="hs-identifier hs-var">scope</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Bool) -&gt; GM ()
</span><a href="Agda.Utils.Warshall.html#addFlex"><span class="hs-identifier hs-var">addFlex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341525"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621681341526"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Agda.Utils.Warshall.html#addConstraint"><span class="hs-identifier hs-var">addConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Arc"><span class="hs-identifier hs-type">Arc</span></a></span><span> </span><span id="local-6989586621681341527"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341527"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621681341528"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341528"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681341529"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341529"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Int -&gt; Node -&gt; GM ()
</span><a href="Agda.Utils.Warshall.html#addEdge"><span class="hs-identifier hs-var">addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341527"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341528"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621681341529"><span class="hs-identifier hs-var">n2</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="annot"><a href="Agda.Utils.Warshall.html#buildGraph"><span class="hs-identifier hs-type">buildGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Constraints"><span class="hs-identifier hs-type">Constraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span>
</span><span id="line-218"></span><span id="buildGraph"><span class="annot"><span class="annottext">buildGraph :: [Constraint] -&gt; Graph
</span><a href="Agda.Utils.Warshall.html#buildGraph"><span class="hs-identifier hs-var hs-var">buildGraph</span></a></span></span><span> </span><span id="local-6989586621681341531"><span class="annot"><span class="annottext">[Constraint]
</span><a href="#local-6989586621681341531"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GM () -&gt; Graph -&gt; Graph
forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Constraint -&gt; GM ()) -&gt; [Constraint] -&gt; GM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; GM ()
</span><a href="Agda.Utils.Warshall.html#addConstraint"><span class="hs-identifier hs-var">addConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">[Constraint]
</span><a href="#local-6989586621681341531"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="Agda.Utils.Warshall.html#initGraph"><span class="hs-identifier hs-var">initGraph</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><a href="Agda.Utils.Warshall.html#mkMatrix"><span class="hs-identifier hs-type">mkMatrix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span>
</span><span id="line-221"></span><span id="mkMatrix"><span class="annot"><span class="annottext">mkMatrix :: Int -&gt; (Int -&gt; Int -&gt; Weight) -&gt; Matrix Weight
</span><a href="Agda.Utils.Warshall.html#mkMatrix"><span class="hs-identifier hs-var hs-var">mkMatrix</span></a></span></span><span> </span><span id="local-6989586621681341535"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341535"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681341536"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Weight
</span><a href="#local-6989586621681341536"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int), (Int, Int)) -&gt; [((Int, Int), Weight)] -&gt; Matrix Weight
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341535"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341535"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>                 </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341537"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341538"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Weight
</span><a href="#local-6989586621681341536"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341537"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341538"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681341537"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341537"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341535"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341538"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341538"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341535"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- displaying matrices with row and column labels --------------------</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="annot"><span class="hs-comment">-- | A matrix with row descriptions in @b@ and column descriptions in @c@.</span></span><span>
</span><span id="line-227"></span><span class="hs-keyword">data</span><span> </span><span id="LegendMatrix"><span class="annot"><a href="Agda.Utils.Warshall.html#LegendMatrix"><span class="hs-identifier hs-var">LegendMatrix</span></a></span></span><span> </span><span id="local-6989586621681341027"><span class="annot"><a href="#local-6989586621681341027"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621681341028"><span class="annot"><a href="#local-6989586621681341028"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621681341029"><span class="annot"><a href="#local-6989586621681341029"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LegendMatrix"><span class="annot"><a href="Agda.Utils.Warshall.html#LegendMatrix"><span class="hs-identifier hs-var">LegendMatrix</span></a></span></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="matrix"><span class="annot"><span class="annottext">forall a b c. LegendMatrix a b c -&gt; Matrix a
</span><a href="Agda.Utils.Warshall.html#matrix"><span class="hs-identifier hs-var hs-var">matrix</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341027"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="rowdescr"><span class="annot"><span class="annottext">forall a b c. LegendMatrix a b c -&gt; Int -&gt; b
</span><a href="Agda.Utils.Warshall.html#rowdescr"><span class="hs-identifier hs-var hs-var">rowdescr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681341028"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="coldescr"><span class="annot"><span class="annottext">forall a b c. LegendMatrix a b c -&gt; Int -&gt; c
</span><a href="Agda.Utils.Warshall.html#coldescr"><span class="hs-identifier hs-var hs-var">coldescr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681341029"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681341043"><span id="local-6989586621681341044"><span id="local-6989586621681341045"><span id="local-6989586621681341548"><span id="local-6989586621681341552"><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341043"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341044"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341045"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#LegendMatrix"><span class="hs-identifier hs-type">LegendMatrix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341043"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341044"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681341045"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621681341576"><span class="annot"><span class="annottext">pretty :: LegendMatrix a b c -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#LegendMatrix"><span class="hs-identifier hs-type">LegendMatrix</span></a></span><span> </span><span id="local-6989586621681341577"><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341577"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681341578"><span class="annot"><span class="annottext">Int -&gt; b
</span><a href="#local-6989586621681341578"><span class="hs-identifier hs-var">rd</span></a></span></span><span> </span><span id="local-6989586621681341579"><span class="annot"><span class="annottext">Int -&gt; c
</span><a href="#local-6989586621681341579"><span class="hs-identifier hs-var">cd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-comment">-- first show column description</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681341580"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341580"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341581"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341581"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341582"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341582"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341583"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341583"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; ((Int, Int), (Int, Int))
forall i e. Array i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341577"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Doc -&gt; Doc) -&gt; Doc -&gt; [Int] -&gt; Doc
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681341584"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341584"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621681341585"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621681341585"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">c -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; c
</span><a href="#local-6989586621681341579"><span class="hs-identifier hs-var">cd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341584"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621681341585"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341581"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341583"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-comment">-- then output rows</span><span>
</span><span id="line-239"></span><span>       </span><span class="annot"><span class="annottext">(Int -&gt; Doc -&gt; Doc) -&gt; Doc -&gt; [Int] -&gt; Doc
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681341586"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341586"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681341587"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621681341587"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; b
</span><a href="#local-6989586621681341578"><span class="hs-identifier hs-var">rd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341586"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span>
</span><span id="line-240"></span><span>                </span><span class="annot"><span class="annottext">(Int -&gt; Doc -&gt; Doc) -&gt; Doc -&gt; [Int] -&gt; Doc
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681341588"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341588"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621681341589"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621681341589"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;\t&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix a
</span><a href="#local-6989586621681341577"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix a -&gt; (Int, Int) -&gt; a
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341586"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341588"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621681341589"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>                      </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621681341587"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-242"></span><span>                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341581"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341583"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>             </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341580"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341582"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-comment">-- solving the constraints -------------------------------------------</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | A solution assigns to each flexible variable a size expression</span><span>
</span><span id="line-248"></span><span class="hs-comment">--   which is either a constant or a @v + n@ for a rigid variable @v@.</span><span>
</span><span id="line-249"></span><span class="hs-keyword">type</span><span> </span><span id="Solution"><span class="annot"><a href="Agda.Utils.Warshall.html#Solution"><span class="hs-identifier hs-var">Solution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#SizeExpr"><span class="hs-identifier hs-type">SizeExpr</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><a href="Agda.Utils.Warshall.html#emptySolution"><span class="hs-identifier hs-type">emptySolution</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span>
</span><span id="line-252"></span><span id="emptySolution"><span class="annot"><span class="annottext">emptySolution :: Solution
</span><a href="Agda.Utils.Warshall.html#emptySolution"><span class="hs-identifier hs-var hs-var">emptySolution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Solution
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="Agda.Utils.Warshall.html#extendSolution"><span class="hs-identifier hs-type">extendSolution</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#SizeExpr"><span class="hs-identifier hs-type">SizeExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span>
</span><span id="line-255"></span><span id="extendSolution"><span class="annot"><span class="annottext">extendSolution :: Solution -&gt; Int -&gt; SizeExpr -&gt; Solution
</span><a href="Agda.Utils.Warshall.html#extendSolution"><span class="hs-identifier hs-var hs-var">extendSolution</span></a></span></span><span> </span><span id="local-6989586621681341592"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341592"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681341593"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341593"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681341594"><span class="annot"><span class="annottext">SizeExpr
</span><a href="#local-6989586621681341594"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SizeExpr -&gt; Solution -&gt; Solution
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341593"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">SizeExpr
</span><a href="#local-6989586621681341594"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341592"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-keyword">data</span><span> </span><span id="SizeExpr"><span class="annot"><a href="Agda.Utils.Warshall.html#SizeExpr"><span class="hs-identifier hs-var">SizeExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SizeVar"><span class="annot"><a href="Agda.Utils.Warshall.html#SizeVar"><span class="hs-identifier hs-var">SizeVar</span></a></span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#RigidId"><span class="hs-identifier hs-type">RigidId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ e.g. x + 5</span></span><span>
</span><span id="line-258"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span id="SizeConst"><span class="annot"><a href="Agda.Utils.Warshall.html#SizeConst"><span class="hs-identifier hs-var">SizeConst</span></a></span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ a number or infinity</span></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681341599"><span id="local-6989586621681341603"><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#SizeExpr"><span class="hs-identifier hs-type">SizeExpr</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>  </span><span id="local-6989586621681341614"><span class="annot"><span class="annottext">pretty :: SizeExpr -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#SizeVar"><span class="hs-identifier hs-type">SizeVar</span></a></span><span> </span><span id="local-6989586621681341615"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341615"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rigid -&gt; Node
</span><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Rigid
</span><a href="Agda.Utils.Warshall.html#RVar"><span class="hs-identifier hs-var">RVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341615"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#SizeVar"><span class="hs-identifier hs-type">SizeVar</span></a></span><span> </span><span id="local-6989586621681341616"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341616"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681341617"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341617"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rigid -&gt; Node
</span><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Rigid
</span><a href="Agda.Utils.Warshall.html#RVar"><span class="hs-identifier hs-var">RVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341616"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">P.&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341617"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#SizeConst"><span class="hs-identifier hs-type">SizeConst</span></a></span><span> </span><span id="local-6989586621681341618"><span class="annot"><span class="annottext">Weight
</span><a href="#local-6989586621681341618"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Weight -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Agda.Syntax.Common.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="#local-6989586621681341618"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="annot"><span class="hs-comment">-- | @sizeRigid r n@ returns the size expression corresponding to @r + n@</span></span><span>
</span><span id="line-266"></span><span class="annot"><a href="Agda.Utils.Warshall.html#sizeRigid"><span class="hs-identifier hs-type">sizeRigid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#SizeExpr"><span class="hs-identifier hs-type">SizeExpr</span></a></span><span>
</span><span id="line-267"></span><span id="sizeRigid"><span class="annot"><span class="annottext">sizeRigid :: Rigid -&gt; Int -&gt; SizeExpr
</span><a href="Agda.Utils.Warshall.html#sizeRigid"><span class="hs-identifier hs-var hs-var">sizeRigid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RConst"><span class="hs-identifier hs-type">RConst</span></a></span><span> </span><span id="local-6989586621681341620"><span class="annot"><span class="annottext">Weight
</span><a href="#local-6989586621681341620"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681341621"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341621"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Weight -&gt; SizeExpr
</span><a href="Agda.Utils.Warshall.html#SizeConst"><span class="hs-identifier hs-var">SizeConst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Weight -&gt; Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#inc"><span class="hs-identifier hs-var">inc</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="#local-6989586621681341620"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341621"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span class="annot"><a href="Agda.Utils.Warshall.html#sizeRigid"><span class="hs-identifier hs-var">sizeRigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RVar"><span class="hs-identifier hs-type">RVar</span></a></span><span> </span><span id="local-6989586621681341622"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341622"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621681341623"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341623"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; SizeExpr
</span><a href="Agda.Utils.Warshall.html#SizeVar"><span class="hs-identifier hs-var">SizeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341622"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341623"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-comment">{-
apply :: SizeExpr -&gt; Solution -&gt; SizeExpr
apply e@(SizeExpr (Rigid _) _) phi = e
apply e@(SizeExpr (Flex  x) i) phi = case Map.lookup x phi of
  Nothing -&gt; e
  Just (SizeExpr v j) -&gt; SizeExpr v (i + j)

after :: Solution -&gt; Solution -&gt; Solution
after psi phi = Map.map (\ e -&gt; e `apply` phi) psi
-}</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">{- compute solution

a solution CANNOT exist if

  v &lt; v  for a rigid variable v

  -- Andreas, 2012-09-19 OUTDATED are:

  -- v &lt;= v' for rigid variables v,v'

  -- x &lt; v   for a flexible variable x and a rigid variable v


thus, for each flexible x, only one of the following cases is possible

  r+n &lt;= x+m &lt;= infty  for a unique rigid r  (meaning r --(m-n)--&gt; x)
  x &lt;= r+n             for a unique rigid r  (meaning x --(n)--&gt; r)

we are looking for the least values for flexible variables that solve
the constraints.  Algorithm

while flexible variables and rigid rows left
  find a rigid variable row i
    for all flexible columns j
      if i --n--&gt; j with n&lt;=0 (meaning i+n &lt;= j) then j = i + n

while flexible variables j left
  search the row j for entry i
    if j --n--&gt; i with n &gt;= 0 (meaning j &lt;= i + n) then j = i + n

-}</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="annot"><a href="Agda.Utils.Warshall.html#solve"><span class="hs-identifier hs-type">solve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Constraints"><span class="hs-identifier hs-type">Constraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span>
</span><span id="line-314"></span><span id="solve"><span class="annot"><span class="annottext">solve :: [Constraint] -&gt; Maybe Solution
</span><a href="Agda.Utils.Warshall.html#solve"><span class="hs-identifier hs-var hs-var">solve</span></a></span></span><span> </span><span id="local-6989586621681341625"><span class="annot"><span class="annottext">[Constraint]
</span><a href="#local-6989586621681341625"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- trace (prettyShow cs) $</span><span>
</span><span id="line-315"></span><span>   </span><span class="hs-comment">-- trace (prettyShow lm0) $</span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-comment">-- trace (prettyShow lm) $ -- trace (prettyShow d) $</span><span>
</span><span id="line-317"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681341626"><span class="annot"><span class="annottext">solution :: Maybe Solution
</span><a href="#local-6989586621681341626"><span class="hs-identifier hs-var hs-var">solution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681341627"><span class="hs-identifier hs-var">solvable</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Rigid] -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341628"><span class="hs-identifier hs-var">loop1</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341629"><span class="hs-identifier hs-var">flexs</span></a></span><span> </span><span class="annot"><span class="annottext">[Rigid]
</span><a href="#local-6989586621681341630"><span class="hs-identifier hs-var">rigids</span></a></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="Agda.Utils.Warshall.html#emptySolution"><span class="hs-identifier hs-var">emptySolution</span></a></span><span>
</span><span id="line-318"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Solution
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-319"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- trace (prettyShow solution) $</span><span>
</span><span id="line-320"></span><span>         </span><span class="annot"><span class="annottext">Maybe Solution
</span><a href="#local-6989586621681341626"><span class="hs-identifier hs-var">solution</span></a></span><span>
</span><span id="line-321"></span><span>   </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- compute the graph and its transitive closure m</span><span>
</span><span id="line-322"></span><span>         </span><span id="local-6989586621681341631"><span class="annot"><span class="annottext">gr :: Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var hs-var">gr</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Constraint] -&gt; Graph
</span><a href="Agda.Utils.Warshall.html#buildGraph"><span class="hs-identifier hs-var">buildGraph</span></a></span><span> </span><span class="annot"><span class="annottext">[Constraint]
</span><a href="#local-6989586621681341625"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-323"></span><span>         </span><span id="local-6989586621681341632"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621681341632"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Graph -&gt; Int
</span><a href="Agda.Utils.Warshall.html#nextNode"><span class="hs-identifier hs-var">nextNode</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span>            </span><span class="hs-comment">-- number of nodes</span><span>
</span><span id="line-324"></span><span>         </span><span id="local-6989586621681341633"><span class="annot"><span class="annottext">m0 :: Matrix Weight
</span><a href="#local-6989586621681341633"><span class="hs-identifier hs-var hs-var">m0</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Int -&gt; Weight) -&gt; Matrix Weight
</span><a href="Agda.Utils.Warshall.html#mkMatrix"><span class="hs-identifier hs-var">mkMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341632"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Int -&gt; Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#graph"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>         </span><span id="local-6989586621681341634"><span class="annot"><span class="annottext">m :: Matrix Weight
</span><a href="#local-6989586621681341634"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Weight -&gt; Matrix Weight
forall a. SemiRing a =&gt; Matrix a -&gt; Matrix a
</span><a href="Agda.Utils.Warshall.html#warshall"><span class="hs-identifier hs-var">warshall</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Weight
</span><a href="#local-6989586621681341633"><span class="hs-identifier hs-var">m0</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>         </span><span class="hs-comment">-- tracing only: build output version of transitive graph</span><span>
</span><span id="line-328"></span><span>         </span><span id="local-6989586621681341635"><span class="annot"><span class="annottext">legend :: Int -&gt; Node
</span><a href="#local-6989586621681341635"><span class="hs-identifier hs-var hs-var">legend</span></a></span></span><span> </span><span id="local-6989586621681341636"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341636"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Node -&gt; Node
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Node -&gt; Node) -&gt; Maybe Node -&gt; Node
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int Node -&gt; Maybe Node
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341636"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Map Int Node
</span><a href="Agda.Utils.Warshall.html#intMap"><span class="hs-identifier hs-var">intMap</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- trace only</span><span>
</span><span id="line-329"></span><span>         </span><span id="local-6989586621681341638"><span class="annot"><span class="annottext">lm0 :: LegendMatrix Weight Node Node
</span><a href="#local-6989586621681341638"><span class="hs-identifier hs-var hs-var">lm0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Weight
-&gt; (Int -&gt; Node) -&gt; (Int -&gt; Node) -&gt; LegendMatrix Weight Node Node
forall a b c.
Matrix a -&gt; (Int -&gt; b) -&gt; (Int -&gt; c) -&gt; LegendMatrix a b c
</span><a href="Agda.Utils.Warshall.html#LegendMatrix"><span class="hs-identifier hs-var">LegendMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Weight
</span><a href="#local-6989586621681341633"><span class="hs-identifier hs-var">m0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Node
</span><a href="#local-6989586621681341635"><span class="hs-identifier hs-var">legend</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Node
</span><a href="#local-6989586621681341635"><span class="hs-identifier hs-var">legend</span></a></span><span>            </span><span class="hs-comment">-- trace only</span><span>
</span><span id="line-330"></span><span>         </span><span id="local-6989586621681341639"><span class="annot"><span class="annottext">lm :: LegendMatrix Weight Node Node
</span><a href="#local-6989586621681341639"><span class="hs-identifier hs-var hs-var">lm</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Weight
-&gt; (Int -&gt; Node) -&gt; (Int -&gt; Node) -&gt; LegendMatrix Weight Node Node
forall a b c.
Matrix a -&gt; (Int -&gt; b) -&gt; (Int -&gt; c) -&gt; LegendMatrix a b c
</span><a href="Agda.Utils.Warshall.html#LegendMatrix"><span class="hs-identifier hs-var">LegendMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Weight
</span><a href="#local-6989586621681341634"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Node
</span><a href="#local-6989586621681341635"><span class="hs-identifier hs-var">legend</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Node
</span><a href="#local-6989586621681341635"><span class="hs-identifier hs-var">legend</span></a></span><span>             </span><span class="hs-comment">-- trace only</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>         </span><span class="hs-comment">-- compute the sets of flexible and rigid node numbers</span><span>
</span><span id="line-333"></span><span>         </span><span id="local-6989586621681341640"><span class="annot"><span class="annottext">ns :: [Node]
</span><a href="#local-6989586621681341640"><span class="hs-identifier hs-var hs-var">ns</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Node Int -&gt; [Node]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Map Node Int
</span><a href="Agda.Utils.Warshall.html#nodeMap"><span class="hs-identifier hs-var">nodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>         </span><span class="hs-comment">-- a set of flexible variables</span><span>
</span><span id="line-335"></span><span>         </span><span id="local-6989586621681341629"><span class="annot"><span class="annottext">flexs :: [Int]
</span><a href="#local-6989586621681341629"><span class="hs-identifier hs-var hs-var">flexs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Node -&gt; [Int]) -&gt; [Int] -&gt; [Node] -&gt; [Int]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681341642"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341642"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Flex"><span class="hs-identifier hs-type">Flex</span></a></span><span> </span><span id="local-6989586621681341643"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341643"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341643"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341642"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-336"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341642"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621681341640"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-337"></span><span>         </span><span class="hs-comment">-- a set of rigid variables</span><span>
</span><span id="line-338"></span><span>         </span><span id="local-6989586621681341630"><span class="annot"><span class="annottext">rigids :: [Rigid]
</span><a href="#local-6989586621681341630"><span class="hs-identifier hs-var hs-var">rigids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Rigid] -&gt; Node -&gt; [Rigid]) -&gt; [Rigid] -&gt; [Node] -&gt; [Rigid]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681341644"><span class="annot"><span class="annottext">[Rigid]
</span><a href="#local-6989586621681341644"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Flex"><span class="hs-identifier hs-type">Flex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Rigid]
</span><a href="#local-6989586621681341644"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-339"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span id="local-6989586621681341645"><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341645"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341645"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid -&gt; [Rigid] -&gt; [Rigid]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Rigid]
</span><a href="#local-6989586621681341644"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621681341640"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>         </span><span class="hs-comment">-- rigid matrix indices</span><span>
</span><span id="line-342"></span><span>         </span><span id="local-6989586621681341646"><span class="annot"><span class="annottext">rInds :: [Int]
</span><a href="#local-6989586621681341646"><span class="hs-identifier hs-var hs-var">rInds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Rigid -&gt; [Int]) -&gt; [Int] -&gt; [Rigid] -&gt; [Int]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681341647"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341647"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681341648"><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341648"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681341649"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341649"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Map Node Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rigid -&gt; Node
</span><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341648"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Map Node Int
</span><a href="Agda.Utils.Warshall.html#nodeMap"><span class="hs-identifier hs-var">nodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>                                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341649"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341647"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Rigid]
</span><a href="#local-6989586621681341630"><span class="hs-identifier hs-var">rigids</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>         </span><span class="hs-comment">-- check whether there is a solution</span><span>
</span><span id="line-346"></span><span>         </span><span class="hs-comment">-- d   = [ m!(i,i) | i &lt;- [0 .. (n-1)] ]  -- diagonal</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- a rigid variable might not be less than it self, so no -.. on the</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- rigid part of the diagonal</span><span>
</span><span id="line-349"></span><span>         </span><span id="local-6989586621681341627"><span class="annot"><span class="annottext">solvable :: Bool
</span><a href="#local-6989586621681341627"><span class="hs-identifier hs-var hs-var">solvable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Weight -&gt; Bool) -&gt; [Weight] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Weight -&gt; Weight -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Weight
</span><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-var">Finite</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Matrix Weight
</span><a href="#local-6989586621681341634"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Weight -&gt; (Int, Int) -&gt; Weight
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341651"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341651"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681341651"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341651"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341646"><span class="hs-identifier hs-var">rInds</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">{-  Andreas, 2012-09-19
    We now can have constraints between rigid variables, like i &lt; j.
    Thus we skip the following two test.  However, a solution must be
    checked for consistency with the constraints on rigid vars.

-- a rigid variable might not be bounded below by infinity or
-- bounded above by a constant
-- it might not be related to another rigid variable
           all (\ (r,  r') -&gt; r == r' ||
                let Just row = (Map.lookup (Rigid r)  (nodeMap gr))
                    Just col = (Map.lookup (Rigid r') (nodeMap gr))
                    edge = m!(row,col)
                in  isBelow r edge r' )
             [ (r,r') | r &lt;- rigids, r' &lt;- rigids ]
           &amp;&amp;
-- a flexible variable might not be strictly below a rigid variable
           all (\ (x, v) -&gt;
                let Just row = (Map.lookup (Flex x)  (nodeMap gr))
                    Just col = (Map.lookup (Rigid (RVar v)) (nodeMap gr))
                    edge = m!(row,col)
                in  edge &gt;= Finite 0)
             [ (x,v) | x &lt;- flexs, (RVar v) &lt;- rigids ]
-}</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>         </span><span class="annot"><a href="#local-6989586621681341652"><span class="hs-identifier hs-type">inScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#FlexId"><span class="hs-identifier hs-type">FlexId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-376"></span><span>         </span><span id="local-6989586621681341652"><span class="annot"><span class="annottext">inScope :: Int -&gt; Rigid -&gt; Bool
</span><a href="#local-6989586621681341652"><span class="hs-identifier hs-var hs-var">inScope</span></a></span></span><span> </span><span id="local-6989586621681341653"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341653"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RConst"><span class="hs-identifier hs-type">RConst</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-377"></span><span>         </span><span class="annot"><a href="#local-6989586621681341652"><span class="hs-identifier hs-var">inScope</span></a></span><span> </span><span id="local-6989586621681341654"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341654"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#RVar"><span class="hs-identifier hs-type">RVar</span></a></span><span> </span><span id="local-6989586621681341655"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341655"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621681341656"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341655"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-378"></span><span>             </span><span class="hs-keyword">where</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681341656"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621681341656"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int (Int -&gt; Bool) -&gt; Maybe (Int -&gt; Bool)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341654"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Map Int (Int -&gt; Bool)
</span><a href="Agda.Utils.Warshall.html#flexScope"><span class="hs-identifier hs-var">flexScope</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="hs-comment">{- loop1

while flexible variables and rigid rows left
  find a rigid variable row i
    for all flexible columns j
      if i --n--&gt; j with n&lt;=0 (meaning i + n &lt;= j) then j = i + n

-}</span><span>
</span><span id="line-388"></span><span>         </span><span class="annot"><a href="#local-6989586621681341628"><span class="hs-identifier hs-type">loop1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.Warshall.html#FlexId"><span class="hs-identifier hs-type">FlexId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span>
</span><span id="line-389"></span><span>         </span><span id="local-6989586621681341628"><span class="annot"><span class="annottext">loop1 :: [Int] -&gt; [Rigid] -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341628"><span class="hs-identifier hs-var hs-var">loop1</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681341657"><span class="annot"><span class="annottext">[Rigid]
</span><a href="#local-6989586621681341657"><span class="hs-identifier hs-var">rgds</span></a></span></span><span> </span><span id="local-6989586621681341658"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341658"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Solution -&gt; Maybe Solution
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341658"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-390"></span><span>         </span><span class="annot"><a href="#local-6989586621681341628"><span class="hs-identifier hs-var">loop1</span></a></span><span> </span><span id="local-6989586621681341659"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341659"><span class="hs-identifier hs-var">flxs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681341660"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341660"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341661"><span class="hs-identifier hs-var">loop2</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341659"><span class="hs-identifier hs-var">flxs</span></a></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341660"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-391"></span><span>         </span><span class="annot"><a href="#local-6989586621681341628"><span class="hs-identifier hs-var">loop1</span></a></span><span> </span><span id="local-6989586621681341662"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341662"><span class="hs-identifier hs-var">flxs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341663"><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341663"><span class="hs-identifier hs-var">r</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681341664"><span class="annot"><span class="annottext">[Rigid]
</span><a href="#local-6989586621681341664"><span class="hs-identifier hs-var">rgds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681341665"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341665"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-392"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681341666"><span class="annot"><span class="annottext">row :: Int
</span><a href="#local-6989586621681341666"><span class="hs-identifier hs-var hs-var">row</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Map Node Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rigid -&gt; Node
</span><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341663"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Map Node Int
</span><a href="Agda.Utils.Warshall.html#nodeMap"><span class="hs-identifier hs-var">nodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621681341667"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341667"><span class="hs-identifier hs-var">flxs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341668"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341668"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-394"></span><span>                  </span><span class="annot"><span class="annottext">(([Int], Solution) -&gt; Int -&gt; ([Int], Solution))
-&gt; ([Int], Solution) -&gt; [Int] -&gt; ([Int], Solution)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341669"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341669"><span class="hs-identifier hs-var">flx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681341670"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341670"><span class="hs-identifier hs-var">sub</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681341671"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341671"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681341672"><span class="annot"><span class="annottext">col :: Int
</span><a href="#local-6989586621681341672"><span class="hs-identifier hs-var hs-var">col</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Map Node Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Node
</span><a href="Agda.Utils.Warshall.html#Flex"><span class="hs-identifier hs-var">Flex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341671"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Map Node Int
</span><a href="Agda.Utils.Warshall.html#nodeMap"><span class="hs-identifier hs-var">nodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>                          </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Rigid -&gt; Bool
</span><a href="#local-6989586621681341652"><span class="hs-identifier hs-var">inScope</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341671"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341663"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Matrix Weight
</span><a href="#local-6989586621681341634"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Weight -&gt; (Int, Int) -&gt; Weight
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341666"><span class="hs-identifier hs-var">row</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341672"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-397"></span><span class="hs-comment">--                                Finite z | z &lt;= 0 -&gt;</span><span>
</span><span id="line-398"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341673"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341673"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-399"></span><span>                                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681341682"><span class="annot"><span class="annottext">trunc :: a -&gt; a
</span><a href="#local-6989586621681341682"><span class="hs-identifier hs-var hs-var">trunc</span></a></span></span><span> </span><span id="local-6989586621681341683"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681341683"><span class="hs-identifier hs-var">z</span></a></span></span><span>
</span><span id="line-400"></span><span>                                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681341683"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-401"></span><span>                                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681341683"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-402"></span><span>                                   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341669"><span class="hs-identifier hs-var">flx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Solution -&gt; Int -&gt; SizeExpr -&gt; Solution
</span><a href="Agda.Utils.Warshall.html#extendSolution"><span class="hs-identifier hs-var">extendSolution</span></a></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341670"><span class="hs-identifier hs-var">sub</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341671"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rigid -&gt; Int -&gt; SizeExpr
</span><a href="Agda.Utils.Warshall.html#sizeRigid"><span class="hs-identifier hs-var">sizeRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341663"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall {a}. (Ord a, Num a) =&gt; a -&gt; a
</span><a href="#local-6989586621681341682"><span class="hs-identifier hs-var">trunc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341673"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>                                </span><span class="annot"><span class="annottext">(Bool, Weight)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341671"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341669"><span class="hs-identifier hs-var">flx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341670"><span class="hs-identifier hs-var">sub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>                     </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341665"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341662"><span class="hs-identifier hs-var">flxs</span></a></span><span>
</span><span id="line-405"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Rigid] -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341628"><span class="hs-identifier hs-var">loop1</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341667"><span class="hs-identifier hs-var">flxs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Rigid]
</span><a href="#local-6989586621681341664"><span class="hs-identifier hs-var">rgds</span></a></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341668"><span class="hs-identifier hs-var">subst'</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="hs-comment">{- loop2

while flexible variables j left
  search the row j for entry i
    if j --n--&gt; i with n &gt;= 0 (meaning j &lt;= i + n) then j = i

-}</span><span>
</span><span id="line-414"></span><span>         </span><span class="annot"><a href="#local-6989586621681341661"><span class="hs-identifier hs-type">loop2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Utils.Warshall.html#FlexId"><span class="hs-identifier hs-type">FlexId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span>
</span><span id="line-415"></span><span>         </span><span id="local-6989586621681341661"><span class="annot"><span class="annottext">loop2 :: [Int] -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341661"><span class="hs-identifier hs-var hs-var">loop2</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681341684"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341684"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Solution -&gt; Maybe Solution
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341684"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-416"></span><span>         </span><span class="annot"><a href="#local-6989586621681341661"><span class="hs-identifier hs-var">loop2</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681341685"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341685"><span class="hs-identifier hs-var">f</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681341686"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341686"><span class="hs-identifier hs-var">flxs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681341687"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341687"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341688"><span class="hs-identifier hs-var">loop3</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341687"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-417"></span><span>           </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681341689"><span class="annot"><span class="annottext">row :: Int
</span><a href="#local-6989586621681341689"><span class="hs-identifier hs-var hs-var">row</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Map Node Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Node
</span><a href="Agda.Utils.Warshall.html#Flex"><span class="hs-identifier hs-var">Flex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341685"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Map Node Int
</span><a href="Agda.Utils.Warshall.html#nodeMap"><span class="hs-identifier hs-var">nodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>                 </span><span id="local-6989586621681341688"><span class="annot"><span class="annottext">loop3 :: Int -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341688"><span class="hs-identifier hs-var hs-var">loop3</span></a></span></span><span> </span><span id="local-6989586621681341690"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341690"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span id="local-6989586621681341691"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341691"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341690"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341632"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-419"></span><span>                   </span><span class="hs-comment">-- default to infinity</span><span>
</span><span id="line-420"></span><span>                    </span><span class="annot"><span class="annottext">[Int] -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341661"><span class="hs-identifier hs-var">loop2</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341686"><span class="hs-identifier hs-var">flxs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Solution -&gt; Int -&gt; SizeExpr -&gt; Solution
</span><a href="Agda.Utils.Warshall.html#extendSolution"><span class="hs-identifier hs-var">extendSolution</span></a></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341691"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341685"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Weight -&gt; SizeExpr
</span><a href="Agda.Utils.Warshall.html#SizeConst"><span class="hs-identifier hs-var">SizeConst</span></a></span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>                 </span><span class="annot"><a href="#local-6989586621681341688"><span class="hs-identifier hs-var">loop3</span></a></span><span> </span><span id="local-6989586621681341692"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341692"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span id="local-6989586621681341693"><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341693"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-422"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int Node -&gt; Maybe Node
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341692"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph -&gt; Map Int Node
</span><a href="Agda.Utils.Warshall.html#intMap"><span class="hs-identifier hs-var">intMap</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621681341631"><span class="hs-identifier hs-var">gr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-423"></span><span>                     </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Warshall.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span id="local-6989586621681341694"><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341694"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rigid -&gt; Bool
</span><a href="Agda.Utils.Warshall.html#infinite"><span class="hs-identifier hs-var">infinite</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341694"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-424"></span><span>                       </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Rigid -&gt; Bool
</span><a href="#local-6989586621681341652"><span class="hs-identifier hs-var">inScope</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341685"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341694"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Matrix Weight
</span><a href="#local-6989586621681341634"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Weight -&gt; (Int, Int) -&gt; Weight
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341689"><span class="hs-identifier hs-var">row</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341692"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-425"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Warshall.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621681341696"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341696"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341696"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-426"></span><span>                            </span><span class="annot"><span class="annottext">[Int] -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341661"><span class="hs-identifier hs-var">loop2</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681341686"><span class="hs-identifier hs-var">flxs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Solution -&gt; Int -&gt; SizeExpr -&gt; Solution
</span><a href="Agda.Utils.Warshall.html#extendSolution"><span class="hs-identifier hs-var">extendSolution</span></a></span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341693"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341685"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rigid -&gt; Int -&gt; SizeExpr
</span><a href="Agda.Utils.Warshall.html#sizeRigid"><span class="hs-identifier hs-var">sizeRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Rigid
</span><a href="#local-6989586621681341694"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341696"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Weight
</span><a href="Agda.Utils.Warshall.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341688"><span class="hs-identifier hs-var">loop3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341692"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341693"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-428"></span><span>                        </span><span class="annot"><span class="annottext">(Bool, Weight)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- trace (&quot;unusable rigid: &quot; ++ prettyShow r ++ &quot; for flex &quot; ++ prettyShow f)</span><span>
</span><span id="line-429"></span><span>                              </span><span class="annot"><span class="annottext">Maybe Solution
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-comment">-- NOT: loop3 (col+1) subst</span><span>
</span><span id="line-430"></span><span>                     </span><span class="annot"><span class="annottext">Maybe Node
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Solution -&gt; Maybe Solution
</span><a href="#local-6989586621681341688"><span class="hs-identifier hs-var">loop3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681341692"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Solution
</span><a href="#local-6989586621681341693"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-431"></span></pre></body></html>